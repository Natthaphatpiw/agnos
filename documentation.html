<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symptom Recommendation API - Technical Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --background: #ffffff;
            --surface: #f8fafc;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-light: #64748b;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --sidebar-width: 280px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--surface);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .logo {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .logo h1 {
            font-size: 1.25rem;
            color: var(--primary);
            font-weight: 700;
        }

        .logo p {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-light);
            padding: 0 1.5rem;
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
        }

        .nav-item {
            display: block;
            padding: 0.5rem 1.5rem;
            color: var(--text);
            text-decoration: none;
            font-size: 0.875rem;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(37, 99, 235, 0.05);
            color: var(--primary);
        }

        .nav-item.active {
            background: rgba(37, 99, 235, 0.05);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 3rem;
            max-width: 1200px;
        }

        .hero {
            margin-bottom: 3rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.125rem;
            color: var(--text-light);
            max-width: 700px;
        }

        .section {
            margin-bottom: 4rem;
            scroll-margin-top: 2rem;
        }

        .section h2 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .section h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            color: var(--primary);
        }

        .section h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 1.5rem 0 1rem;
        }

        .section p {
            margin-bottom: 1rem;
            color: var(--text-light);
            line-height: 1.8;
        }

        .section ul, .section ol {
            margin: 1rem 0 1rem 1.5rem;
            color: var(--text-light);
        }

        .section li {
            margin-bottom: 0.5rem;
        }

        /* Cards */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        /* Code Blocks */
        .code-block {
            background: var(--code-bg);
            color: var(--code-text);
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', Consolas, Monaco, monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            position: relative;
        }

        .code-block pre {
            margin: 0;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-lang {
            font-size: 0.75rem;
            color: var(--text-light);
            text-transform: uppercase;
            font-weight: 600;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--code-text);
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.75rem;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Inline Code */
        code {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', Consolas, Monaco, monospace;
            font-size: 0.875em;
        }

        .code-block code {
            background: transparent;
            color: inherit;
            padding: 0;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        th {
            background: var(--surface);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text);
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: var(--surface);
        }

        /* API Reference */
        .endpoint {
            background: white;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            margin: 2rem 0;
            overflow: hidden;
        }

        .endpoint-header {
            background: var(--surface);
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .endpoint-method {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-weight: 600;
            font-size: 0.75rem;
            margin-right: 0.75rem;
        }

        .method-post { background: #10b981; color: white; }
        .method-get { background: #3b82f6; color: white; }

        .endpoint-path {
            font-family: 'Courier New', Consolas, Monaco, monospace;
            font-size: 1rem;
            color: var(--text);
        }

        .endpoint-body {
            padding: 1.5rem;
        }

        .param-list {
            list-style: none;
            margin: 1rem 0;
        }

        .param-item {
            padding: 1rem;
            background: var(--surface);
            border-radius: 0.25rem;
            margin-bottom: 0.75rem;
        }

        .param-name {
            font-family: 'Courier New', Consolas, Monaco, monospace;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .param-type {
            display: inline-block;
            font-size: 0.75rem;
            color: var(--text-light);
            background: rgba(37, 99, 235, 0.1);
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
        }

        .param-required {
            color: var(--error);
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        .param-desc {
            color: var(--text-light);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            border-bottom: 2px solid var(--border);
            margin-bottom: 1rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-light);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Note boxes */
        .note {
            background: rgba(37, 99, 235, 0.05);
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0.25rem;
        }

        .note-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                padding: 1.5rem;
            }

            .hero h1 {
                font-size: 2rem;
            }
        }

        @media print {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                max-width: 100%;
            }

            .code-block {
                page-break-inside: avoid;
            }
        }

        /* Syntax Highlighting */
        .keyword { color: #c678dd; }
        .string { color: #98c379; }
        .number { color: #d19a66; }
        .comment { color: #5c6370; font-style: italic; }
        .function { color: #61afef; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="logo">
                <h1>Symptom API</h1>
                <p>Technical Documentation</p>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Getting Started</div>
                <a href="#introduction" class="nav-item active">Introduction</a>
                <a href="#quick-start" class="nav-item">Quick Start</a>
                <a href="#architecture" class="nav-item">System Architecture</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Machine Learning</div>
                <a href="#ml-overview" class="nav-item">Overview</a>
                <a href="#collaborative-filtering" class="nav-item">Collaborative Filtering</a>
                <a href="#content-based" class="nav-item">Content-Based Filtering</a>
                <a href="#graph-neural-network" class="nav-item">Graph Neural Network</a>
                <a href="#fusion" class="nav-item">Score Fusion</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Training Process</div>
                <a href="#data-preprocessing" class="nav-item">Data Preprocessing</a>
                <a href="#training-loop" class="nav-item">Training Loop</a>
                <a href="#evaluation" class="nav-item">Evaluation</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">API Reference</div>
                <a href="#api-recommend" class="nav-item">POST /recommend</a>
                <a href="#api-health" class="nav-item">GET /health</a>
                <a href="#api-symptoms" class="nav-item">GET /symptoms</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Examples</div>
                <a href="#examples" class="nav-item">Use Cases</a>
                <a href="#error-handling" class="nav-item">Error Handling</a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Hero Section -->
            <div class="hero">
                <h1>Symptom Recommendation API</h1>
                <p>
                    ระบบแนะนำอาการทางการแพทย์ด้วยเทคนิค Deep Learning โดยรวม Collaborative Filtering,
                    Content-Based Filtering และ Graph Neural Networks เพื่อให้การทำนายที่แม่นยำและครบถ้วน
                </p>
            </div>

            <!-- Introduction -->
            <section id="introduction" class="section">
                <h2>Introduction</h2>
                <p>
                    Symptom Recommendation API ทำหน้าที่แนะนำอาการทางการแพทย์ที่อาจเกิดขึ้นต่อไป
                    โดยอิงจากข้อมูลประวัติผู้ป่วยที่มีอาการคล้ายกัน หลักการทำงานคล้ายกับระบบแนะนำสินค้าใน e-commerce
                    หรือระบบแนะนำหนังใน Netflix แต่ถูกปรับให้เหมาะสมกับข้อมูลทางการแพทย์
                </p>

                <div class="card">
                    <div class="card-title">คุณสมบัติหลัก</div>
                    <ul>
                        <li>Hybrid Machine Learning Model รวม 3 เทคนิคหลัก</li>
                        <li>รองรับข้อมูลภาษาไทยและภาษาอังกฤษ</li>
                        <li>ความเร็วในการตอบกลับ 20-50ms บน CPU</li>
                        <li>FastAPI framework พร้อม automatic documentation</li>
                        <li>สามารถขยายระบบได้ตามจำนวนผู้ใช้งาน</li>
                    </ul>
                </div>

                <div class="note">
                    <div class="note-title">ตัวอย่างการใช้งาน</div>
                    ผู้ป่วยชายอายุ 26 ปี มีอาการไอ ระบบจะแนะนำอาการที่เป็นไปได้ เช่น
                    เสมหะ, เจ็บคอ, น้ำมูกไหล, ไข้, ปวดศีรษะ โดยอิงจากข้อมูลผู้ป่วยที่มีอาการคล้ายกันในอดีต
                </div>
            </section>

            <!-- Quick Start -->
            <section id="quick-start" class="section">
                <h2>Quick Start</h2>

                <h3>Installation</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">bash</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre><code><span class="comment"># Clone repository</span>
git clone https://github.com/yourname/symptom-api.git
cd symptom-api

<span class="comment"># Install dependencies</span>
pip install -r requirements.txt

<span class="comment"># Train model</span>
python train.py

<span class="comment"># Start API server</span>
python -m uvicorn app:app --reload</code></pre>
                </div>

                <h3>Making Your First Request</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">bash</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre><code>curl -X POST http://localhost:8000/recommend \
  -H <span class="string">"Content-Type: application/json"</span> \
  -d <span class="string">'{
    "gender": "male",
    "age": 26,
    "symptoms": ["ไอ"],
    "top_k": 5
  }'</span></code></pre>
                </div>

                <h3>Expected Response</h3>
                <div class="code-block">
                    <pre><code>{
  <span class="string">"recommendations"</span>: [<span class="string">"เสมหะ"</span>, <span class="string">"เจ็บคอ"</span>, <span class="string">"น้ำมูกไหล"</span>, <span class="string">"ไข้"</span>, <span class="string">"ปวดศีรษะ"</span>],
  <span class="string">"query_symptoms"</span>: [<span class="string">"ไอ"</span>],
  <span class="string">"unknown_symptoms"</span>: []
}</code></pre>
                </div>
            </section>

            <!-- Architecture Overview -->
            <section id="architecture" class="section">
                <h2>System Architecture</h2>
                <p>
                    ระบบประกอบด้วย 2 ส่วนหลัก คือ Machine Learning Model สำหรับการทำนาย
                    และ FastAPI Backend สำหรับให้บริการผ่าน REST API
                </p>

                <h3>High-Level Architecture</h3>
                <div class="code-block">
                    <pre><code>Input (Gender, Age, Symptoms)
         ↓
    ┌────┴────────────────────────────┐
    │      Feature Encoding           │
    │   (Demographics + Embeddings)   │
    └────┬────────────────────────────┘
         ↓
    ┌────┴────┬─────────┬──────────┐
    │         │         │          │
┌───┴───┐ ┌──┴───┐ ┌───┴────┐     │
│  CF   │ │  CB  │ │ Graph  │     │
│ (NCF) │ │(Cos) │ │ (GAT)  │     │
└───┬───┘ └──┬───┘ └───┬────┘     │
    │        │         │          │
    └────┬───┴────┬────┘          │
         │        │               │
         ↓        ↓               ↓
    Weighted Fusion (0.4+0.4+0.2)
         ↓
    Top-K Selection
         ↓
    Recommendations</code></pre>
                </div>
            </section>

            <!-- ML Overview -->
            <section id="ml-overview" class="section">
                <h2>Machine Learning Model</h2>
                <p>
                    โมเดลใช้แนวทาง Hybrid Architecture ที่รวมจุดแข็งของ 3 เทคนิคเข้าด้วยกัน
                    เพื่อให้ได้ผลลัพธ์ที่มีความแม่นยำและครอบคลุมกรณีต่างๆ
                </p>

                <table>
                    <thead>
                        <tr>
                            <th>เทคนิค</th>
                            <th>หลักการ</th>
                            <th>จุดแข็ง</th>
                            <th>Weight</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Collaborative Filtering</td>
                            <td>เรียนรู้จากพฤติกรรมผู้ป่วยที่มีอาการคล้ายกัน</td>
                            <td>ทำนายได้แม่นยำจากข้อมูลจริง</td>
                            <td>40%</td>
                        </tr>
                        <tr>
                            <td>Content-Based</td>
                            <td>วิเคราะห์ความคล้ายคลึงของอาการโดยตรง</td>
                            <td>ทำงานได้กับผู้ป่วยใหม่</td>
                            <td>40%</td>
                        </tr>
                        <tr>
                            <td>Graph Neural Network</td>
                            <td>เรียนรู้จาก co-occurrence patterns</td>
                            <td>จับความสัมพันธ์ระหว่างอาการ</td>
                            <td>20%</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Collaborative Filtering -->
            <section id="collaborative-filtering" class="section">
                <h2>Collaborative Filtering (NCF)</h2>

                <h3>Concept</h3>
                <p>
                    Collaborative Filtering ทำงานโดยค้นหาผู้ป่วยที่มีอาการเริ่มต้นคล้ายกัน
                    แล้วนำอาการเพิ่มเติมของผู้ป่วยเหล่านั้นมาเป็นข้อมูลในการแนะนำ
                    คล้ายกับวิธีที่ Netflix แนะนำหนังโดยดูจากผู้ใช้ที่มีรสนิยมคล้ายกัน
                </p>

                <div class="note">
                    <div class="note-title">ตัวอย่าง</div>
                    <p>ผู้ป่วย A มีอาการ: ไอ, เสมหะ</p>
                    <p>ผู้ป่วย B มีอาการ: ไอ, เสมหะ, เจ็บคอ, ไข้</p>
                    <p>ระบบจะแนะนำ "เจ็บคอ" และ "ไข้" ให้ผู้ป่วย A เพราะมีอาการเริ่มต้นคล้ายกับผู้ป่วย B</p>
                </div>

                <h3>Neural Collaborative Filtering (NCF)</h3>
                <p>
                    เราใช้ NCF ซึ่งเป็นเวอร์ชันปรับปรุงของ Collaborative Filtering แบบดั้งเดิม
                    โดยใช้ Neural Networks ในการเรียนรู้ความสัมพันธ์ที่ซับซ้อนระหว่างผู้ป่วยกับอาการ
                </p>

                <h4>Architecture Components</h4>

                <div class="card">
                    <div class="card-title">1. Generalized Matrix Factorization (GMF)</div>
                    <p>
                        GMF ทำการคูณ embeddings ของผู้ป่วยกับอาการแบบ element-wise
                        เพื่อวัดความเข้ากันได้ระหว่างผู้ป่วยกับอาการนั้น
                    </p>
                    <div class="code-block">
                        <pre><code>patient_embed = Embedding(patient_idx)      <span class="comment"># [batch, 128]</span>
symptom_embed = Embedding(symptom_idx)      <span class="comment"># [batch, 128]</span>
gmf_vector = patient_embed * symptom_embed  <span class="comment"># Element-wise product</span>
gmf_score = Linear(gmf_vector)              <span class="comment"># [batch, 1]</span></code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">2. Multi-Layer Perceptron (MLP)</div>
                    <p>
                        MLP รับ concatenation ของ embeddings และ demographics
                        แล้วผ่าน 4 layers เพื่อเรียนรู้ความสัมพันธ์ที่ซับซ้อน
                    </p>
                    <div class="code-block">
                        <pre><code>mlp_input = Concat([patient_embed, symptom_embed, demographics])
<span class="comment"># 272 dimensions (128 + 128 + 16)</span>

Layer <span class="number">1</span>: <span class="number">272</span> → <span class="number">256</span> (ReLU, BatchNorm, Dropout)
Layer <span class="number">2</span>: <span class="number">256</span> → <span class="number">128</span> (ReLU, BatchNorm, Dropout)
Layer <span class="number">3</span>: <span class="number">128</span> → <span class="number">64</span>  (ReLU, BatchNorm, Dropout)
Layer <span class="number">4</span>: <span class="number">64</span>  → <span class="number">32</span>  (ReLU, BatchNorm, Dropout)
Output:  <span class="number">32</span>  → <span class="number">1</span>

mlp_score = Linear(<span class="number">32</span>, <span class="number">1</span>)</code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">3. Score Combination</div>
                    <div class="code-block">
                        <pre><code>cf_score = gmf_score + mlp_score
cf_normalized = sigmoid(cf_score)</code></pre>
                    </div>
                </div>

                <h3>Advantages</h3>
                <ul>
                    <li>GMF จับความสัมพันธ์แบบ linear ได้รวดเร็วและมีเสถียรภาพ</li>
                    <li>MLP จับความสัมพันธ์แบบ non-linear ที่ซับซ้อนได้แม่นยำ</li>
                    <li>การรวมทั้งสองวิธีทำให้ได้ทั้งความเร็วและความแม่นยำ</li>
                </ul>
            </section>

            <!-- Content-Based Filtering -->
            <section id="content-based" class="section">
                <h2>Content-Based Filtering</h2>

                <h3>Concept</h3>
                <p>
                    Content-Based Filtering วิเคราะห์ความคล้ายคลึงระหว่างอาการโดยตรง
                    ไม่พึ่งพาข้อมูลจากผู้ป่วยคนอื่น คล้ายกับการหาเพลงที่มีแนวเพลงและจังหวะคล้ายกัน
                    โดยไม่สนใจว่าคนอื่นฟังเพลงอะไร
                </p>

                <div class="note">
                    <div class="note-title">ตัวอย่าง</div>
                    <p>ถ้าผู้ป่วยมีอาการ "ไอ"</p>
                    <p>ระบบจะหาอาการที่คล้ายกัน เช่น "เสมหะ", "เจ็บคอ"
                    เพราะทั้งหมดเป็นอาการของระบบทางเดินหายใจ</p>
                    <p>แต่จะไม่แนะนำ "ปวดท้อง" เพราะไม่มีความเกี่ยวข้องกัน</p>
                </div>

                <h3>Implementation</h3>
                <p>
                    เราใช้ Cosine Similarity เพื่อวัดความคล้าย โดยคำนวณจากมุมระหว่าง
                    vector embeddings ของอาการ
                </p>

                <h4>Process</h4>

                <div class="card">
                    <div class="card-title">Step 1: Symptom Embeddings</div>
                    <p>แต่ละอาการจะถูก encode เป็น vector 128 มิติ ที่เรียนรู้มาจากข้อมูล</p>
                    <div class="code-block">
                        <pre><code>embed("ไอ")     = [<span class="number">0.23</span>, -<span class="number">0.45</span>, <span class="number">0.12</span>, ..., <span class="number">0.89</span>]
embed("เสมหะ")  = [<span class="number">0.25</span>, -<span class="number">0.40</span>, <span class="number">0.15</span>, ..., <span class="number">0.85</span>]
embed("ปวดท้อง") = [-<span class="number">0.10</span>, <span class="number">0.30</span>, -<span class="number">0.25</span>, ..., -<span class="number">0.12</span>]</code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Step 2: Cosine Similarity Calculation</div>
                    <div class="code-block">
                        <pre><code><span class="comment"># Normalize vectors</span>
query_norm = normalize(embed("ไอ"))
candidate_norm = normalize(embed("เสมหะ"))

<span class="comment"># Compute cosine similarity</span>
similarity = dot_product(query_norm, candidate_norm)

<span class="comment"># Example results:</span>
cosine_sim("ไอ", "เสมหะ")  = <span class="number">0.92</span>  <span class="comment"># High similarity</span>
cosine_sim("ไอ", "ปวดท้อง") = <span class="number">0.15</span>  <span class="comment"># Low similarity</span></code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Step 3: Normalization</div>
                    <p>Convert cosine similarity from [-1, 1] to [0, 1] range</p>
                    <div class="code-block">
                        <pre><code>cb_score = (cosine_similarity + <span class="number">1</span>) / <span class="number">2</span></code></pre>
                    </div>
                </div>

                <h3>Advantages</h3>
                <ul>
                    <li>ทำงานได้กับผู้ป่วยใหม่ที่ไม่มีประวัติ (Cold Start Problem)</li>
                    <li>สามารถอธิบายได้ว่าทำไมแนะนำอาการนั้น (Explainability)</li>
                    <li>คำนวณได้รวดเร็ว เพราะเป็นเพียง dot product</li>
                    <li>ให้ผลลัพธ์ที่หลากหลาย ไม่จำกัดแค่อาการยอดนิยม</li>
                </ul>
            </section>

            <!-- Graph Neural Network -->
            <section id="graph-neural-network" class="section">
                <h2>Graph Neural Network (GAT)</h2>

                <h3>Concept</h3>
                <p>
                    Graph Neural Network เรียนรู้ความสัมพันธ์ระหว่างอาการผ่าน graph structure
                    โดย nodes คืออาการต่างๆ และ edges คือความถี่ที่อาการเกิดร่วมกัน (co-occurrence)
                </p>

                <p>
                    หลักการคล้ายกับ Social Network ที่คนที่รู้จักกันจะมี connection
                    และเพื่อนของเพื่อนก็มีโอกาสจะรู้จักกัน (friend of friend)
                </p>

                <div class="note">
                    <div class="note-title">ตัวอย่าง Graph Structure</div>
                    <div class="code-block">
                        <pre><code>[ไอ] ━━━━━━ (156 times) ━━━━━━ [เสมหะ]
  ┃
  ┃ (203 times)
  ┃
[เจ็บคอ] ━━ (89 times) ━━ [น้ำมูกไหล]</code></pre>
                    </div>
                    <p>ตัวเลขแสดงจำนวนครั้งที่อาการเกิดร่วมกันในผู้ป่วยคนเดียวกัน</p>
                </div>

                <h3>Graph Attention Network (GAT)</h3>
                <p>
                    เราใช้ GAT ซึ่งเป็น Graph Neural Network ที่มี Attention Mechanism
                    ทำให้สามารถเรียนรู้ได้ว่า neighbor อาการไหนมีความสำคัญมากกว่า
                </p>

                <h4>Architecture</h4>

                <div class="card">
                    <div class="card-title">Graph Construction</div>
                    <div class="code-block">
                        <pre><code><span class="comment"># Nodes: All symptoms (338 symptoms)</span>
nodes = [<span class="string">"ไอ"</span>, <span class="string">"เสมหะ"</span>, <span class="string">"เจ็บคอ"</span>, ..., <span class="string">"ปวดหัว"</span>]

<span class="comment"># Edges: Co-occurrence relationships</span>
edges = [
    (<span class="string">"ไอ"</span>, <span class="string">"เสมหะ"</span>, weight=<span class="number">156</span>),
    (<span class="string">"ไอ"</span>, <span class="string">"เจ็บคอ"</span>, weight=<span class="number">203</span>),
    (<span class="string">"เสมหะ"</span>, <span class="string">"น้ำมูกไหล"</span>, weight=<span class="number">89</span>),
    ...
]</code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">GAT Layer 1: Multi-head Attention (4 heads)</div>
                    <div class="code-block">
                        <pre><code>x = symptom_embeddings.weight  <span class="comment"># [338, 128]</span>

<span class="comment"># Apply GAT layer with 4 attention heads</span>
h1 = GAT_Layer1(x, edge_index, heads=<span class="number">4</span>)  <span class="comment"># [338, 512]</span>
h1 = ELU(h1)
h1 = Dropout(h1, p=<span class="number">0.3</span>)</code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">GAT Layer 2: Single-head Attention</div>
                    <div class="code-block">
                        <pre><code><span class="comment"># Second layer for deeper propagation</span>
h2 = GAT_Layer2(h1, edge_index, heads=<span class="number">1</span>)  <span class="comment"># [338, 128]</span>

<span class="comment"># Final GAT embeddings</span>
gat_embeddings = h2</code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Attention Mechanism</div>
                    <p>
                        สำหรับแต่ละ node GAT จะคำนวณ attention weights กับ neighbors
                        เพื่อเรียนรู้ว่าอาการไหนมีความเกี่ยวข้องมากกว่า
                    </p>
                    <div class="code-block">
                        <pre><code><span class="keyword">for</span> neighbor <span class="keyword">in</span> neighbors:
    <span class="comment"># Compute attention coefficient</span>
    alpha = LeakyReLU(W1 @ embed(node) + W2 @ embed(neighbor))

<span class="comment"># Normalize with softmax</span>
attention_weights = softmax([alpha_1, alpha_2, ..., alpha_n])

<span class="comment"># Weighted aggregation</span>
new_embed(node) = Σ (attention_weights[i] × embed(neighbor_i))</code></pre>
                    </div>
                </div>

                <h3>Advantages</h3>
                <ul>
                    <li>จับ co-occurrence patterns ได้ดี เช่น อาการที่มักเกิดร่วมกัน</li>
                    <li>เรียนรู้ความสัมพันธ์ทางอ้อมผ่าน multi-hop connections</li>
                    <li>Attention mechanism ให้น้ำหนักกับอาการที่เกี่ยวข้องมากกว่า</li>
                    <li>Embedding เปลี่ยนไปตาม context ของอาการรอบข้าง</li>
                </ul>
            </section>

            <!-- Fusion Strategy -->
            <section id="fusion" class="section">
                <h2>Score Fusion Strategy</h2>

                <h3>Rationale</h3>
                <p>
                    แต่ละเทคนิคมีจุดแข็งและจุดอ่อนที่แตกต่างกัน การรวมคะแนนจากทั้ง 3 วิธี
                    จะช่วยให้ได้ผลลัพธ์ที่สมดุลและแม่นยำมากขึ้น
                </p>

                <ul>
                    <li><strong>Collaborative Filtering:</strong> แม่นยำแต่มีปัญหา cold start</li>
                    <li><strong>Content-Based:</strong> แก้ปัญหา cold start แต่อาจจำกัดความหลากหลาย</li>
                    <li><strong>Graph:</strong> จับ co-occurrence ดี แต่อาจ overfit</li>
                </ul>

                <h3>Fusion Process</h3>

                <div class="card">
                    <div class="card-title">Step 1: Score Normalization</div>
                    <p>ปรับคะแนนทุกสายให้อยู่ในช่วง [0, 1]</p>
                    <div class="code-block">
                        <pre><code><span class="comment"># CF score through sigmoid</span>
cf_norm = sigmoid(cf_score)

<span class="comment"># CB score from cosine [-1, 1] to [0, 1]</span>
cb_norm = (cb_score + <span class="number">1</span>) / <span class="number">2</span>

<span class="comment"># Graph score from cosine [-1, 1] to [0, 1]</span>
graph_norm = (graph_score + <span class="number">1</span>) / <span class="number">2</span></code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Step 2: Learnable Weights</div>
                    <div class="code-block">
                        <pre><code><span class="comment"># Initialize fusion weights</span>
fusion_weights = nn.Parameter([<span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">0.2</span>])

<span class="comment"># Apply softmax to ensure sum = 1</span>
weights = softmax(fusion_weights)</code></pre>
                    </div>
                    <p>น้ำหนักเหล่านี้จะถูกปรับให้เหมาะสมระหว่างการ training</p>
                </div>

                <div class="card">
                    <div class="card-title">Step 3: Weighted Combination</div>
                    <div class="code-block">
                        <pre><code>final_score = (
    weights[<span class="number">0</span>] * cf_norm +
    weights[<span class="number">1</span>] * cb_norm +
    weights[<span class="number">2</span>] * graph_norm
)</code></pre>
                    </div>
                </div>

                <h3>Weight Distribution</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Initial Weight</th>
                            <th>Rationale</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Collaborative Filtering</td>
                            <td>40%</td>
                            <td>เรียนรู้จากข้อมูลจริง มีความแม่นยำสูง</td>
                        </tr>
                        <tr>
                            <td>Content-Based</td>
                            <td>40%</td>
                            <td>ช่วยแก้ปัญหา cold start และเพิ่มความหลากหลาย</td>
                        </tr>
                        <tr>
                            <td>Graph Neural Network</td>
                            <td>20%</td>
                            <td>เสริมด้วย co-occurrence context</td>
                        </tr>
                    </tbody>
                </table>

                <div class="note">
                    <div class="note-title">หมายเหตุ</div>
                    น้ำหนักเหล่านี้เป็นค่าเริ่มต้น จะถูกปรับอัตโนมัติระหว่าง training
                    ผ่าน backpropagation เพื่อหาค่าที่เหมาะสมที่สุดกับข้อมูล
                </div>
            </section>

            <!-- Data Preprocessing -->
            <section id="data-preprocessing" class="section">
                <h2>Data Preprocessing</h2>

                <h3>Input Data Format</h3>
                <p>ข้อมูลเป็น CSV file ที่ประกอบด้วย columns หลัก 4 columns:</p>

                <div class="code-block">
                    <pre><code>gender,age,summary,search_term
male,28,"{""yes_symptoms"": [...], ""no_symptoms"": [...]}","ไอ, เสมหะ"</code></pre>
                </div>

                <h3>Preprocessing Steps</h3>

                <h4>1. Parse JSON Summary</h4>
                <div class="code-block">
                    <pre><code>summary = json.loads(row[<span class="string">'summary'</span>])

yes_symptoms = []
<span class="keyword">for</span> sym_obj <span class="keyword">in</span> summary[<span class="string">'yes_symptoms'</span>]:
    symptom = sym_obj[<span class="string">'text'</span>]
    answers = sym_obj[<span class="string">'answers'</span>]
    severity = parse_severity(answers)

    yes_symptoms.append(symptom)
    symptom_details[symptom] = {
        <span class="string">'answers'</span>: answers,
        <span class="string">'severity'</span>: severity
    }</code></pre>
                </div>

                <h4>2. Build Vocabulary</h4>
                <div class="code-block">
                    <pre><code>all_symptoms = set()

<span class="keyword">for</span> patient <span class="keyword">in</span> patients:
    all_symptoms.update(patient[<span class="string">'yes_symptoms'</span>])
    all_symptoms.update(patient[<span class="string">'no_symptoms'</span>])

symptom_to_idx = {sym: idx <span class="keyword">for</span> idx, sym <span class="keyword">in</span> enumerate(sorted(all_symptoms))}
idx_to_symptom = {idx: sym <span class="keyword">for</span> sym, idx <span class="keyword">in</span> symptom_to_idx.items()}</code></pre>
                </div>

                <h4>3. Create Interaction Matrix</h4>
                <div class="code-block">
                    <pre><code>interaction_matrix = np.zeros((num_patients, num_symptoms), dtype=np.float32)

<span class="keyword">for</span> patient_idx, patient <span class="keyword">in</span> enumerate(patients):
    <span class="keyword">for</span> symptom <span class="keyword">in</span> patient[<span class="string">'yes_symptoms'</span>]:
        sym_idx = symptom_to_idx[symptom]
        severity = patient[<span class="string">'symptom_details'</span>][symptom][<span class="string">'severity'</span>]
        interaction_matrix[patient_idx, sym_idx] = severity

    <span class="keyword">for</span> symptom <span class="keyword">in</span> patient[<span class="string">'no_symptoms'</span>]:
        sym_idx = symptom_to_idx[symptom]
        interaction_matrix[patient_idx, sym_idx] = -<span class="number">1.0</span></code></pre>
                </div>

                <h4>4. Build Co-occurrence Graph</h4>
                <div class="code-block">
                    <pre><code>G = nx.Graph()
G.add_nodes_from(range(num_symptoms))

edge_weights = defaultdict(float)

<span class="keyword">for</span> patient <span class="keyword">in</span> patients:
    symptoms = patient[<span class="string">'yes_symptoms'</span>]
    symptom_indices = [symptom_to_idx[s] <span class="keyword">for</span> s <span class="keyword">in</span> symptoms]

    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(symptom_indices)):
        <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>, len(symptom_indices)):
            edge = tuple(sorted([symptom_indices[i], symptom_indices[j]]))
            edge_weights[edge] += <span class="number">1.0</span></code></pre>
                </div>

                <h4>5. Encode Demographics</h4>
                <div class="code-block">
                    <pre><code>age_bins = [<span class="number">0</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">100</span>]

<span class="keyword">for</span> patient <span class="keyword">in</span> patients:
    <span class="comment"># Gender one-hot</span>
    gender_vec = np.zeros(<span class="number">2</span>)
    gender_vec[<span class="number">0</span> <span class="keyword">if</span> patient[<span class="string">'gender'</span>] == <span class="string">'male'</span> <span class="keyword">else</span> <span class="number">1</span>] = <span class="number">1.0</span>

    <span class="comment"># Age bin one-hot</span>
    age_bin_vec = np.zeros(<span class="number">4</span>)
    bin_idx = np.digitize(patient[<span class="string">'age'</span>], age_bins) - <span class="number">1</span>
    age_bin_vec[bin_idx] = <span class="number">1.0</span></code></pre>
                </div>
            </section>

            <!-- Training Loop -->
            <section id="training-loop" class="section">
                <h2>Training Loop</h2>

                <h3>Hyperparameters</h3>
                <div class="code-block">
                    <pre><code>EMBED_DIM = <span class="number">128</span>
BATCH_SIZE = <span class="number">32</span>
EPOCHS = <span class="number">50</span>
LEARNING_RATE = <span class="number">1e-3</span>
WEIGHT_DECAY = <span class="number">1e-5</span></code></pre>
                </div>

                <h3>Model Initialization</h3>
                <div class="code-block">
                    <pre><code>model = SymptomRecommender(
    num_symptoms=<span class="number">338</span>,
    num_patients=<span class="number">1000</span>,
    symptom_embed_dim=<span class="number">128</span>
)

optimizer = AdamW(model.parameters(), lr=LEARNING_RATE, weight_decay=WEIGHT_DECAY)
scheduler = ReduceLROnPlateau(optimizer, mode=<span class="string">'max'</span>, factor=<span class="number">0.5</span>, patience=<span class="number">5</span>)
criterion = nn.BCELoss()</code></pre>
                </div>

                <h3>Training Process</h3>
                <div class="code-block">
                    <pre><code><span class="keyword">for</span> epoch <span class="keyword">in</span> range(EPOCHS):
    model.train()

    <span class="keyword">for</span> batch <span class="keyword">in</span> train_loader:
        optimizer.zero_grad()

        <span class="comment"># Forward pass</span>
        scores = model(
            patient_idx=batch[<span class="string">'patient_idx'</span>],
            gender=batch[<span class="string">'gender'</span>],
            age_bin=batch[<span class="string">'age_bin'</span>],
            query_symptoms=batch[<span class="string">'query_symptoms'</span>],
            edge_index=edge_index
        )

        <span class="comment"># Compute loss</span>
        loss = criterion(scores, batch[<span class="string">'labels'</span>])

        <span class="comment"># Backward pass</span>
        loss.backward()
        torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=<span class="number">1.0</span>)
        optimizer.step()

    <span class="comment"># Validation</span>
    val_precision, val_recall = evaluate(model, val_loader, edge_index)
    scheduler.step(val_recall)

    <span class="comment"># Save best model</span>
    <span class="keyword">if</span> val_recall > best_val_recall:
        torch.save(model.state_dict(), <span class="string">'model.pth'</span>)</code></pre>
                </div>
            </section>

            <!-- Evaluation -->
            <section id="evaluation" class="section">
                <h2>Evaluation Metrics</h2>

                <h3>Precision@K</h3>
                <p>วัดความแม่นยำของการแนะนำ คิดจากอาการที่ถูกต้องในผลลัพธ์ top-K</p>
                <div class="code-block">
                    <pre><code>Precision@K = (จำนวนอาการที่ถูกต้องใน top-K) / K</code></pre>
                </div>

                <h3>Recall@K</h3>
                <p>วัดความครอบคลุม คิดจากอาการที่ถูกต้องที่สามารถหาได้จากทั้งหมด</p>
                <div class="code-block">
                    <pre><code>Recall@K = (จำนวนอาการที่ถูกต้องใน top-K) / (จำนวนอาการที่ควรแนะนำทั้งหมด)</code></pre>
                </div>

                <h3>Example Calculation</h3>
                <div class="note">
                    <div class="note-title">ตัวอย่าง</div>
                    <p><strong>Ground Truth:</strong> ["เสมหะ", "เจ็บคอ", "น้ำมูกไหล"] (3 อาการ)</p>
                    <p><strong>Predicted Top-5:</strong> ["เสมหะ", "ไข้", "เจ็บคอ", "ปวดศีรษะ", "คลื่นไส้"]</p>
                    <p><strong>Correct Predictions:</strong> ["เสมหะ", "เจ็บคอ"] (2 อาการ)</p>
                    <p><strong>Precision@5 =</strong> 2/5 = 0.40</p>
                    <p><strong>Recall@5 =</strong> 2/3 = 0.67</p>
                </div>

                <h3>Expected Performance</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Training Set</th>
                            <th>Validation Set</th>
                            <th>Test Set</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Precision@5</td>
                            <td>0.72</td>
                            <td>0.65</td>
                            <td>0.62</td>
                        </tr>
                        <tr>
                            <td>Recall@5</td>
                            <td>0.68</td>
                            <td>0.60</td>
                            <td>0.58</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- API Reference -->
            <section id="api-recommend" class="section">
                <h2>API Reference</h2>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <div>
                            <span class="endpoint-method method-post">POST</span>
                            <span class="endpoint-path">/recommend</span>
                        </div>
                        <p style="margin-top: 0.5rem; color: var(--text-light); font-size: 0.875rem;">
                            Generate symptom recommendations based on patient data
                        </p>
                    </div>
                    <div class="endpoint-body">
                        <h4>Request Body</h4>
                        <ul class="param-list">
                            <li class="param-item">
                                <div class="param-name">
                                    gender
                                    <span class="param-type">string</span>
                                    <span class="param-required">required</span>
                                </div>
                                <div class="param-desc">
                                    Patient gender. Must be "male" or "female"
                                </div>
                            </li>
                            <li class="param-item">
                                <div class="param-name">
                                    age
                                    <span class="param-type">integer</span>
                                    <span class="param-required">required</span>
                                </div>
                                <div class="param-desc">
                                    Patient age (0-120 years)
                                </div>
                            </li>
                            <li class="param-item">
                                <div class="param-name">
                                    symptoms
                                    <span class="param-type">array[string]</span>
                                    <span class="param-required">required</span>
                                </div>
                                <div class="param-desc">
                                    List of initial symptoms (Thai or English). Minimum 1 symptom required.
                                </div>
                            </li>
                            <li class="param-item">
                                <div class="param-name">
                                    top_k
                                    <span class="param-type">integer</span>
                                    <span style="color: var(--text-light); font-size: 0.75rem;">optional</span>
                                </div>
                                <div class="param-desc">
                                    Number of recommendations to return (1-20). Default: 5
                                </div>
                            </li>
                        </ul>

                        <h4>Response</h4>
                        <ul class="param-list">
                            <li class="param-item">
                                <div class="param-name">
                                    recommendations
                                    <span class="param-type">array[string]</span>
                                </div>
                                <div class="param-desc">
                                    List of recommended symptoms, sorted by likelihood
                                </div>
                            </li>
                            <li class="param-item">
                                <div class="param-name">
                                    query_symptoms
                                    <span class="param-type">array[string]</span>
                                </div>
                                <div class="param-desc">
                                    Recognized symptoms from the input (present in vocabulary)
                                </div>
                            </li>
                            <li class="param-item">
                                <div class="param-name">
                                    unknown_symptoms
                                    <span class="param-type">array[string]</span>
                                </div>
                                <div class="param-desc">
                                    Unrecognized symptoms (not in vocabulary)
                                </div>
                            </li>
                        </ul>

                        <div class="tabs">
                            <button class="tab active" onclick="switchTab(event, 'req1')">Request</button>
                            <button class="tab" onclick="switchTab(event, 'res1')">Response</button>
                            <button class="tab" onclick="switchTab(event, 'curl1')">cURL</button>
                        </div>

                        <div id="req1" class="tab-content active">
                            <div class="code-block">
                                <pre><code>{
  <span class="string">"gender"</span>: <span class="string">"male"</span>,
  <span class="string">"age"</span>: <span class="number">26</span>,
  <span class="string">"symptoms"</span>: [<span class="string">"ไอ"</span>, <span class="string">"เสมหะ"</span>],
  <span class="string">"top_k"</span>: <span class="number">5</span>
}</code></pre>
                            </div>
                        </div>

                        <div id="res1" class="tab-content">
                            <div class="code-block">
                                <pre><code>{
  <span class="string">"recommendations"</span>: [
    <span class="string">"เจ็บคอ"</span>,
    <span class="string">"น้ำมูกไหล"</span>,
    <span class="string">"ไข้"</span>,
    <span class="string">"ปวดศีรษะ"</span>,
    <span class="string">"คัดจมูก"</span>
  ],
  <span class="string">"query_symptoms"</span>: [<span class="string">"ไอ"</span>, <span class="string">"เสมหะ"</span>],
  <span class="string">"unknown_symptoms"</span>: []
}</code></pre>
                            </div>
                        </div>

                        <div id="curl1" class="tab-content">
                            <div class="code-block">
                                <pre><code>curl -X POST http://localhost:8000/recommend \
  -H <span class="string">"Content-Type: application/json"</span> \
  -d <span class="string">'{
    "gender": "male",
    "age": 26,
    "symptoms": ["ไอ", "เสมหะ"],
    "top_k": 5
  }'</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="endpoint" id="api-health">
                    <div class="endpoint-header">
                        <div>
                            <span class="endpoint-method method-get">GET</span>
                            <span class="endpoint-path">/health</span>
                        </div>
                        <p style="margin-top: 0.5rem; color: var(--text-light); font-size: 0.875rem;">
                            Check API server health status
                        </p>
                    </div>
                    <div class="endpoint-body">
                        <h4>Response</h4>
                        <div class="code-block">
                            <pre><code>{
  <span class="string">"status"</span>: <span class="string">"healthy"</span>,
  <span class="string">"model_loaded"</span>: <span class="keyword">true</span>,
  <span class="string">"device"</span>: <span class="string">"cpu"</span>,
  <span class="string">"vocabulary_size"</span>: <span class="number">338</span>
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="endpoint" id="api-symptoms">
                    <div class="endpoint-header">
                        <div>
                            <span class="endpoint-method method-get">GET</span>
                            <span class="endpoint-path">/symptoms</span>
                        </div>
                        <p style="margin-top: 0.5rem; color: var(--text-light); font-size: 0.875rem;">
                            List available symptoms in vocabulary
                        </p>
                    </div>
                    <div class="endpoint-body">
                        <h4>Query Parameters</h4>
                        <ul class="param-list">
                            <li class="param-item">
                                <div class="param-name">
                                    limit
                                    <span class="param-type">integer</span>
                                    <span style="color: var(--text-light); font-size: 0.75rem;">optional</span>
                                </div>
                                <div class="param-desc">
                                    Maximum number of symptoms to return. Default: 50
                                </div>
                            </li>
                        </ul>

                        <h4>Response</h4>
                        <div class="code-block">
                            <pre><code>{
  <span class="string">"symptoms"</span>: [<span class="string">"ไอ"</span>, <span class="string">"เสมหะ"</span>, <span class="string">"เจ็บคอ"</span>, <span class="string">"..."</span>],
  <span class="string">"total"</span>: <span class="number">338</span>,
  <span class="string">"showing"</span>: <span class="number">50</span>
}</code></pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Error Handling -->
            <section id="error-handling" class="section">
                <h2>Error Handling</h2>

                <div class="card">
                    <div class="card-title">400 Bad Request - Invalid Gender</div>
                    <div class="code-block">
                        <pre><code>{
  <span class="string">"detail"</span>: <span class="string">"Gender must be 'male' or 'female'"</span>
}</code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">400 Bad Request - Unknown Symptoms</div>
                    <div class="code-block">
                        <pre><code>{
  <span class="string">"detail"</span>: <span class="string">"None of the provided symptoms are in the vocabulary. Unknown: ['ท้องแสบ']"</span>
}</code></pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">500 Internal Server Error</div>
                    <div class="code-block">
                        <pre><code>{
  <span class="string">"detail"</span>: <span class="string">"Internal server error: ..."</span>
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Examples -->
            <section id="examples" class="section">
                <h2>Usage Examples</h2>

                <h3>Example 1: Single Symptom Query</h3>
                <div class="card">
                    <div class="code-block">
                        <pre><code><span class="comment"># Request</span>
POST /recommend
{
  <span class="string">"gender"</span>: <span class="string">"male"</span>,
  <span class="string">"age"</span>: <span class="number">26</span>,
  <span class="string">"symptoms"</span>: [<span class="string">"ไอ"</span>]
}

<span class="comment"># Response</span>
{
  <span class="string">"recommendations"</span>: [<span class="string">"เสมหะ"</span>, <span class="string">"เจ็บคอ"</span>, <span class="string">"น้ำมูกไหล"</span>, <span class="string">"ไข้"</span>, <span class="string">"ปวดศีรษะ"</span>]
}</code></pre>
                    </div>
                </div>

                <h3>Example 2: Multiple Symptoms Query</h3>
                <div class="card">
                    <div class="code-block">
                        <pre><code><span class="comment"># Request</span>
POST /recommend
{
  <span class="string">"gender"</span>: <span class="string">"female"</span>,
  <span class="string">"age"</span>: <span class="number">35</span>,
  <span class="string">"symptoms"</span>: [<span class="string">"ปวดท้อง"</span>, <span class="string">"คลื่นไส้"</span>]
}

<span class="comment"># Response</span>
{
  <span class="string">"recommendations"</span>: [<span class="string">"อาเจียน"</span>, <span class="string">"ท้องเสีย"</span>, <span class="string">"จุกแน่นท้อง"</span>, <span class="string">"ไข้"</span>, <span class="string">"ปวดศีรษะ"</span>]
}</code></pre>
                    </div>
                </div>

                <h3>Example 3: Unknown Symptom Handling</h3>
                <div class="card">
                    <div class="code-block">
                        <pre><code><span class="comment"># Request</span>
POST /recommend
{
  <span class="string">"gender"</span>: <span class="string">"male"</span>,
  <span class="string">"age"</span>: <span class="number">45</span>,
  <span class="string">"symptoms"</span>: [<span class="string">"ท้องแสบ"</span>, <span class="string">"ปวดท้อง"</span>]
}

<span class="comment"># Response</span>
{
  <span class="string">"recommendations"</span>: [<span class="string">"คลื่นไส้"</span>, <span class="string">"จุกแน่นท้อง"</span>, <span class="string">"อาเจียน"</span>, <span class="string">"ท้องเสีย"</span>, <span class="string">"ท้องอืด"</span>],
  <span class="string">"query_symptoms"</span>: [<span class="string">"ปวดท้อง"</span>],
  <span class="string">"unknown_symptoms"</span>: [<span class="string">"ท้องแสบ"</span>]
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <div style="margin-top: 4rem; padding-top: 2rem; border-top: 2px solid var(--border); color: var(--text-light); text-align: center;">
                <p>
                    <strong>Symptom Recommendation API v1.0</strong><br>
                    Built with PyTorch, FastAPI, and PyTorch Geometric<br>
                    <span style="font-size: 0.875rem;">2024</span>
                </p>
            </div>
        </main>
    </div>

    <script>
        // Smooth scroll navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Copy code functionality
        function copyCode(btn) {
            const codeBlock = btn.closest('.code-block').querySelector('code');
            const text = codeBlock.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }

        // Tab switching
        function switchTab(event, tabId) {
            const container = event.target.closest('.endpoint-body');
            const tabs = container.querySelectorAll('.tab');
            const contents = container.querySelectorAll('.tab-content');

            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Auto-highlight current section in navigation
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    document.querySelectorAll('.nav-item').forEach(item => {
                        if (item.getAttribute('href') === `#${id}`) {
                            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                            item.classList.add('active');
                        }
                    });
                }
            });
        }, { threshold: 0.5 });

        document.querySelectorAll('.section').forEach(section => {
            observer.observe(section);
        });
    </script>
</body>
</html>
